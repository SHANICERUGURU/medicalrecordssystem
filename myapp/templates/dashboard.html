{% extends 'base.html' %}

{% block content %}
<div class="container mt-5">
  <!-- Authentication Check -->
  {% if user.is_authenticated %}
    
    <!-- Header with logout on right -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="text-primary mb-0">
        {% if patient %}
          Welcome, {{ patient.user.get_full_name|default:user.username }}!
        {% elif doctor %}
          Welcome, Dr. {{ doctor.user.get_full_name|default:user.username }}!
        {% else %}
          Welcome, {{ user.get_full_name|default:user.username }}!
        {% endif %}
      </h2>
      
      <!-- Logout Button on the right -->
      <form action="{% url 'logout' %}" method="post" class="d-inline">
        {% csrf_token %}
        <button type="submit" class="btn btn-outline-danger">Logout</button>
      </form>
    </div>

    {% if patient %}
      <!-- Patient Records Section -->
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">Health Profile</h5>
        </div>
        <div class="card-body">
          <p><strong>Blood Type:</strong> {{ patient.blood_type|default:"Not provided" }}</p>
          <p><strong>Allergies:</strong> {{ patient.allergies|default:"None reported" }}</p>
          <p><strong>Chronic Illness:</strong> {{ patient.chronic_illness|default:"None reported" }}</p>
          <p><strong>Last Appointment:</strong> {{ patient.last_appointment|date:"M d, Y"|default:"No record" }}</p>
          <p><strong>Last Doctor:</strong> {{ patient.last_doctor|default:"Not specified" }}</p>
          {% if patient.emergency_contact_name and patient.emergency_contact_phone %}
            <p><strong>Emergency Contact:</strong> {{ patient.emergency_contact_name }} ({{ patient.emergency_contact_phone }})</p>
          {% else %}
            <p><strong>Emergency Contact:</strong> Not provided</p>
          {% endif %}
          <p><strong>Insurance Type:</strong> {{ patient.insurance_type|default:"Not provided" }}</p>
          <p><strong>Current Medications:</strong> {{ patient.current_medications|default:"None" }}</p>
          <p><strong>Family Medical History:</strong> {{ patient.family_medical_history|default:"Not provided" }}</p>
        </div>
      </div>

      <!-- Edit Profile Button -->
      <a href="{% url 'my_profile_edit' request.user.id %}" class="btn btn-primary">Edit My Details</a>

    {% elif doctor %}
      <!-- Doctor Profile Section -->
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-info text-white">
          <h5 class="mb-0">Professional Profile</h5>
        </div>
        <div class="card-body">
          <p><strong>Specialty:</strong> {{ doctor.get_specialty_display }}</p>
          <p><strong>Hospital:</strong> {{ doctor.hospital|default:"Not provided" }}</p>
          <p><strong>License Number:</strong> {{ doctor.license_number|default:"Not provided" }}</p>
          <p><strong>Member Since:</strong> {{ doctor.created_at|date:"M d, Y" }}</p>
        </div>
      </div>

      <!-- Doctor-specific actions -->
      <div class="d-grid gap-2 d-md-block mb-3">
        <a href="#" class="btn btn-info me-md-2">View My Appointments</a>
        <a href="#" class="btn btn-info me-md-2">My Patients</a>
        <a href="{% url 'doctoreditprofile' request.user.id %}" class="btn btn-primary">Edit My Professional Details</a>
      </div>

    {% else %}
      <!-- User is authenticated but doesn't have a profile -->
      <div class="alert alert-warning">
        <div class="d-flex justify-content-between align-items-start">
          <div>
            <h4 class="alert-heading">Profile Setup Required</h4>
            <p>Welcome! Let's complete your profile so we can personalize your dashboard.</p>
          </div>
        </div>
        <hr>
        <div class="d-grid gap-2 d-md-block">
          <a href="{% url 'doctorprofilesetup' %}" class="btn btn-outline-info">Set Up Doctor Profile</a>
        </div>
      </div>
    {% endif %}

  {% else %}
    <!-- User is not authenticated -->
    <div class="row justify-content-center">
      <div class="col-md-6">
        <div class="card shadow-lg">
          <div class="card-header bg-primary text-white">
            <h5 class="mb-0">Login to Access Your Dashboard</h5>
          </div>
          <div class="card-body">
            <form method="POST" action="{% url 'login' %}">
              {% csrf_token %}
              {{ form.as_p }}
              <button type="submit" class="btn btn-success w-100">Login</button>
            </form>
            <hr>
            <div class="text-center">
              <p>Don't have an account? <a href="{% url 'register' %}">Register here</a></p>
            </div>
          </div>
        </div>
      </div>
    </div>
  {% endif %}
</div> <!-- Close container div -->
{% endblock %}